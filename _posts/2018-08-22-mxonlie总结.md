---
title: "Django 开发 MxOnline 项目笔记"
date: 2018-08-22 10:40 +0800
categories: python
tags: django
description: Django 开发 MxOnline 项目笔记
---



### 用户注册功能实现 | 用户 登录、注册、找回密码

1. 在不编写 view 视图函数的情况下，可以直接访问前端静态页面，只需要利用 Django 自带的类视图 TemplateView 即可完成。

   ```python
   from django.views.generic import TemplateView
   path("login/", TemplateView.as_view(template_name="login.html"), name="login")
   ```


2. 利用 django 自带的 authenticate 和 login 来完成用户验证登录。

   ```python
   from django.contrib.auth import authenticate, login, logout
   ...
   user = authenticate(username=user_name, password=pass_word)
      if user:
          login(request, user)
   ```


3. 在前台模板中判断用户是否登录可以用 user 对象的 is_authenticated 方法

  if request.user.is_authenticated 

4. 扩展用户使用邮箱登录

   + setting 中重载 AUTHENTICATION_BACKENDS 变量

     ```
     AUTHENTICATION_BACKENDS = ["users.views.CustomBackend"]
     ```

   + users/view.py中自定义CustomBackend类，重写anthenticate方法

     ```html
         def authenticate(self, request, username=None, password=None, **kwargs):
             # 这里覆写 authenticate 方法, 在此完成自己的后台逻辑, 实现可以通过用户名或邮箱登录网站
             try:
                 # 首先根据用户名和密码来查询一下这个用户是否存在于数据库
                 # 因为用户名在数据库中是不能重名的, 所以可以用 .get() 方法来查询
                 user = UserProfile.objects.get(Q(username=username) | Q(email=username))
                 # 这里查询密码的方式是不能和上面查询用户名一样的因为 django 在将密码存储到数据库中是加密的所以不能简单的使用 objects.get(password=password) 来查询,
                 # 前台 request 传进来的明文 password 是不可能和数据库中加密的 password 匹配的, 所以无法查询不过 因为 UserProfile 继承自 django 的 AbstractUser而 AbstractUser 有一个 check_password 方法, 可以将传进去的明文 password 进行加密处理然后和 user 对象的 password 字段做对比, 验证密码是否和这个用户的密码
                 if user.check_password(password):
                     # 如果判断成功, 即用户名和密码相匹配, 返回 user 对象
                     return user
             except Exception as err:
                 # 遇到异常, 即用户名或密码不匹配, 返回 None
                 return None
     ```


#### 静态文件配置

1. 开发环境(debug=True)

* 配置STATIC_URL

  ```python
  STATIC_URL = '/static/'
  ```
* 当你有多个静态文件目录的时候可以使用下面的方式， 设置STATICFILES_DIRS



* 模板中使用

  ```html
  load staticfiles 
  <img src=" static "my_app/myexample.jpg" " alt="My image"/>
  ```



2. 部署(debug=False)

* 设置STATIC_ROOT:

  ```
  STATIC_ROOT = "/var/www/example.com/static/"
  ```

* 执行`python manage.py collectstatic`
