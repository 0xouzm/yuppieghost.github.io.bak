<h3 id="用户注册功能实现--用户-登录注册找回密码">用户注册功能实现 | 用户 登录、注册、找回密码</h3>

<ol>
  <li>
    <p>在不编写 view 视图函数的情况下，可以直接访问前端静态页面，只需要利用 Django 自带的类视图 TemplateView 即可完成。</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<span class="n">path</span><span class="p">(</span><span class="s">"login/"</span><span class="p">,</span> <span class="n">TemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">"login.html"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">"login"</span><span class="p">)</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>利用 django 自带的 authenticate 和 login 来完成用户验证登录。</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">logout</span>
<span class="o">...</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user_name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">pass_word</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
       <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>在前台模板中判断用户是否登录可以用 user 对象的 is_authenticated 方法</p>
  </li>
</ol>

<p>if request.user.is_authenticated</p>

<ol>
  <li>
    <p>扩展用户使用邮箱登录</p>

    <ul>
      <li>
        <p>setting 中重载 AUTHENTICATION_BACKENDS 变量</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>AUTHENTICATION_BACKENDS = ["users.views.CustomBackend"]
</code></pre>
        </div>
      </li>
      <li>
        <p>users/view.py中自定义CustomBackend类，重写anthenticate方法</p>

        <div class="language-html highlighter-rouge"><pre class="highlight"><code>    def authenticate(self, request, username=None, password=None, **kwargs):
        # 这里覆写 authenticate 方法, 在此完成自己的后台逻辑, 实现可以通过用户名或邮箱登录网站
        try:
            # 首先根据用户名和密码来查询一下这个用户是否存在于数据库
            # 因为用户名在数据库中是不能重名的, 所以可以用 .get() 方法来查询
            user = UserProfile.objects.get(Q(username=username) | Q(email=username))
            # 这里查询密码的方式是不能和上面查询用户名一样的因为 django 在将密码存储到数据库中是加密的所以不能简单的使用 objects.get(password=password) 来查询,
            # 前台 request 传进来的明文 password 是不可能和数据库中加密的 password 匹配的, 所以无法查询不过 因为 UserProfile 继承自 django 的 AbstractUser而 AbstractUser 有一个 check_password 方法, 可以将传进去的明文 password 进行加密处理然后和 user 对象的 password 字段做对比, 验证密码是否和这个用户的密码
            if user.check_password(password):
                # 如果判断成功, 即用户名和密码相匹配, 返回 user 对象
                return user
        except Exception as err:
            # 遇到异常, 即用户名或密码不匹配, 返回 None
            return None
</code></pre>
        </div>
      </li>
    </ul>
  </li>
</ol>

<h4 id="静态文件配置">静态文件配置</h4>

<ol>
  <li>开发环境(debug=True)</li>
</ol>

<ul>
  <li>
    <p>配置STATIC_URL</p>

    <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">'/static/'</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>当你有多个静态文件目录的时候可以使用下面的方式， 设置STATICFILES_DIRS</p>
  </li>
  <li>
    <p>模板中使用</p>

    <div class="language-html highlighter-rouge"><pre class="highlight"><code>load staticfiles 
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">" static "</span><span class="na">my_app</span><span class="err">/</span><span class="na">myexample</span><span class="err">.</span><span class="na">jpg</span><span class="err">"</span> <span class="err">"</span> <span class="na">alt=</span><span class="s">"My image"</span><span class="nt">/&gt;</span>
</code></pre>
    </div>
  </li>
</ul>

<ol>
  <li>部署(debug=False)</li>
</ol>

<ul>
  <li>
    <p>设置STATIC_ROOT:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>STATIC_ROOT = "/var/www/example.com/static/"
</code></pre>
    </div>
  </li>
  <li>
    <p>执行<code class="highlighter-rouge">python manage.py collectstatic</code></p>
  </li>
</ul>
